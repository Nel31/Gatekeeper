---
config:
  layout: fixed
  theme: redux
  look: neo
---
flowchart TB
 subgraph Legende["ğŸ“– LÃ‰GENDE"]
        L1["DonnÃ©es/Interface"]
        L2["Traitement"]
        L3["DÃ©cision"]
        L4["Automatique"]
        L5["Manuel"]
        L6["Sortie/Rapport"]
        L7["Stockage persistant"]
  end
 subgraph Notes["ğŸ“Œ NOTES IMPORTANTES"]
    direction LR
        N1["<b>Seuils configurables:</b><br>â€¢ SimilaritÃ©: 85%<br>â€¢ InactivitÃ©: 120 jours"]
        N2["<b>Whitelist persistante:</b><br>â€¢ CSV dans AppData<br>â€¢ Apprentissage continu"]
        N3["<b>DÃ©cisions auto:</b><br>â€¢ Inactifs â†’ DÃ©sactiver<br>â€¢ Non RH â†’ DÃ©sactiver<br>â€¢ Variations â†’ Conserver"]
  end
    Start(["ğŸš€ DÃ‰BUT"]) --> Load["ğŸ“ Ã‰TAPE 1: CHARGEMENT<br>Interface de saisie"]
    Cert[/"ğŸ‘¤ Nom Certificateur"/] --> Load
    RH[/"ğŸ“Š Fichiers RH<br>Excel - RÃ©fÃ©rentiel"/] --> Load
    Extract[/"ğŸ“„ Fichier Extraction<br>Export Application"/] --> Load
    Template[/"ğŸ“‹ Template Rapport<br>ModÃ¨le Excel"/] --> Load
    Load --> Process{"ğŸ”„ Traitement des donnÃ©es"}
    Process --> Sub1["Chargement et prÃ©paration RH<br>charger_et_preparer_rh"] & Sub2["Chargement extraction<br>charger_et_preparer_ext<br>+ Filtrage suspendus"] & Sub3["Association RH â†” Extraction<br>par code_utilisateur"]
    Sub1 --> Detect["ğŸ” DÃ©tection Anomalies<br>detecter_anomalies"]
    Sub2 --> Detect
    Sub3 --> Detect
    Detect --> TypeAnomaly@{ label: "Type d'anomalie<br>dÃ©tectÃ©e?" }
    TypeAnomaly -- Non RH --> NonRH["ğŸš« Compte non RH<br>Absent du rÃ©fÃ©rentiel"]
    TypeAnomaly -- Inactif --> Inactive["ğŸ’¤ InactivitÃ©<br>&gt; 120 jours"]
    TypeAnomaly -- Profil --> ProfileCheck{"Analyse profil<br>Fuzzy + SÃ©mantique"}
    TypeAnomaly -- Direction --> DirectionCheck{"Analyse direction<br>Fuzzy + SÃ©mantique"}
    ProfileCheck -- Variation<br>â‰¥85% similaritÃ© --> ProfileVar["ğŸ“ Variation profil<br>Ex: Dev â†’ DÃ©veloppeur"]
    ProfileCheck -- Changement<br>&lt;85% + sÃ©mantique --> ProfileChange["ğŸ”„ Changement profil<br>Ex: Dev â†’ Chef projet"]
    DirectionCheck -- Variation --> DirVar["ğŸ“ Variation direction<br>Ex: DSI â†’ D.S.I."]
    DirectionCheck -- Changement --> DirChange["ğŸ”„ Changement direction<br>Ex: DSI â†’ Marketing"]
    NonRH --> AutoDecision["ğŸ¤– DÃ©cision Auto:<br>DÃ‰SACTIVER"]
    Inactive --> AutoDecision
    ProfileVar --> AutoConserve["ğŸ¤– DÃ©cision Auto:<br>CONSERVER + Whitelist"]
    DirVar --> AutoConserve
    AutoConserve --> Whitelist[("ğŸ’¾ WHITELIST<br>profils_valides.csv<br>directions_conservees.csv")] & ShowAnomalies["ğŸ” Ã‰TAPE 2: ANOMALIES<br>Tableau avec filtres"]
    AutoDecision --> ShowAnomalies
    ProfileChange --> ShowAnomalies
    DirChange --> ShowAnomalies
    ShowAnomalies --> ViewTabs{"Onglets de vue"}
    ViewTabs --> Tab1["ğŸ“Œ Ã€ vÃ©rifier<br>Cas manuels"] & Tab2["ğŸ¤– Auto<br>Cas traitÃ©s auto"] & Tab3["âœ… Conformes<br>Sans anomalie"]
    Tab1 --> NeedValidation{"Cas nÃ©cessitant<br>validation?"}
    NeedValidation -- OUI --> Validation["âœ… Ã‰TAPE 3: VALIDATION<br>Interface cas par cas"]
    Validation --> ShowCase["Affichage du cas:<br>â€¢ Info utilisateur<br>â€¢ Comparaison Ext â†” RH<br>â€¢ Type anomalie"]
    ShowCase --> DecisionChoice{"ğŸ’­ DÃ©cision<br>du certificateur"}
    DecisionChoice -- Modifier --> Modify["âœï¸ MODIFIER<br>Sync avec RH"]
    DecisionChoice -- Conserver --> Keep@{ label: "âœ“ CONSERVER<br>TolÃ©rer l'Ã©cart" }
    DecisionChoice -- DÃ©sactiver --> Disable["âŒ DÃ‰SACTIVER<br>Supprimer compte"]
    DecisionChoice -- Passer --> Skip["â­ï¸ PASSER<br>DÃ©cider plus tard"]
    Modify --> UpdateWhitelist["Ajout whitelist<br>si changement validÃ©"] & Comment["ğŸ’¬ Commentaire<br>optionnel"]
    Keep --> UpdateWhitelist & Comment
    UpdateWhitelist --> Whitelist
    Disable --> Comment
    Comment --> NextCase{"Reste des cas<br>Ã  traiter?"}
    Skip --> NextCase
    NextCase -- OUI --> ShowCase
    NextCase -- NON --> Report["ğŸ“Š Ã‰TAPE 4: RAPPORT<br>PrÃ©paration donnÃ©es"]
    NeedValidation -- NON --> Report
    Report --> PrepareData["PrÃ©parer donnÃ©es:<br>â€¢ set_decision_columns<br>â€¢ Mapping labels<br>â€¢ Date certification"]
    PrepareData --> InjectTemplate["ğŸ’‰ inject_to_template<br>Remplissage Excel"]
    InjectTemplate --> FinalReport[/"ğŸ“„ RAPPORT FINAL<br>rapport_certification_YYYYMMDD.xlsx"/]
    FinalReport --> Stats["ğŸ“ˆ Statistiques affichÃ©es:<br>â€¢ Total: X comptes<br>â€¢ Ã€ conserver: X<br>â€¢ Ã€ modifier: X<br>â€¢ Ã€ dÃ©sactiver: X"]
    Stats --> End(["ğŸ FIN<br>Nouvelle certification possible"])
    TypeAnomaly@{ shape: diamond}
    Keep@{ shape: rect}
     L1:::data
     L2:::process
     L3:::decision
     L4:::auto
     L5:::manual
     L6:::output
     L7:::storage
     Start:::startEnd
     Load:::data
     Cert:::data
     RH:::data
     Extract:::data
     Template:::data
     Process:::process
     Sub1:::process
     Sub2:::process
     Sub3:::process
     Detect:::process
     TypeAnomaly:::decision
     NonRH:::auto
     Inactive:::auto
     ProfileCheck:::decision
     DirectionCheck:::decision
     ProfileVar:::auto
     ProfileChange:::manual
     DirVar:::auto
     DirChange:::manual
     AutoDecision:::auto
     AutoConserve:::auto
     Whitelist:::storage
     ShowAnomalies:::data
     ViewTabs:::decision
     Tab1:::manual
     Tab2:::auto
     Tab3:::data
     NeedValidation:::decision
     Validation:::manual
     ShowCase:::data
     DecisionChoice:::decision
     Modify:::manual
     Keep:::manual
     Disable:::manual
     Skip:::manual
     UpdateWhitelist:::storage
     Comment:::data
     NextCase:::decision
     Report:::output
     PrepareData:::process
     InjectTemplate:::process
     FinalReport:::output
     Stats:::data
     End:::startEnd
    classDef startEnd fill:#f9f9f9,stroke:#333,stroke-width:3px,color:#000
    classDef data fill:#98fb98,stroke:#333,stroke-width:2px,color:#000
    classDef process fill:#87ceeb,stroke:#333,stroke-width:2px,color:#000
    classDef decision fill:#ffd700,stroke:#333,stroke-width:2px,color:#000
    classDef auto fill:#dda0dd,stroke:#333,stroke-width:2px,color:#000
    classDef manual fill:#ffb6c1,stroke:#333,stroke-width:2px,color:#000
    classDef output fill:#ffa500,stroke:#333,stroke-width:2px,color:#000
    classDef storage fill:#e6f3ff,stroke:#333,stroke-width:2px,color:#000
